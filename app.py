import streamlit as st
import google.generativeai as genai
import PIL.Image
import time

# =================é…ç½®å€=================
# ğŸ”´ è¨˜å¾—å¡«å…¥ä½ çš„ Key
MY_API_KEY = "ä½ çš„_GEMINI_API_KEY"
# =======================================

# è¨­å®šé é¢æ¨™é¡Œå’Œåœ–æ¨™
st.set_page_config(page_title="AI é¢ç›¸è²¡é‹åˆ†æ", page_icon="ğŸ”®")

# è¨­å®š API Key
try:
    genai.configure(api_key="AIzaSyDYhvUcK1gq0J75ejGD_qWnyquYK1".strip())
    model = genai.GenerativeModel('gemini-flash-latest')
except:
    st.error("API Key è¨­å®šæœ‰èª¤ï¼Œè«‹æª¢æŸ¥ä»£ç¢¼ã€‚")

# --- ç¶²é ä»‹é¢è¨­è¨ˆ ---
st.title("ğŸ”® AI é¢ç›¸è²¡é‹æ¢æ¸¬å™¨")
st.write("ä¸Šå‚³ç…§ç‰‡ï¼ŒAI å°‡é€éå¤è€é¢ç›¸å­¸çµåˆå¤§æ•¸æ“šï¼Œè§£æä½ çš„**æ½›åœ¨èº«åƒ¹**èˆ‡**è¿‘æœŸæ©Ÿé‡**ã€‚")

# 1. åœ–ç‰‡ä¸Šå‚³å€
uploaded_file = st.file_uploader("è«‹ä¸Šå‚³ä¸€å¼µæ¸…æ™°çš„æ­£é¢ç…§...", type=["jpg", "png", "jpeg"])

if uploaded_file is not None:
    # é¡¯ç¤ºç”¨æˆ¶ä¸Šå‚³çš„ç…§ç‰‡
    image = PIL.Image.open(uploaded_file)
    st.image(image, caption='å·²ä¸Šå‚³ç…§ç‰‡', use_column_width=True)

    # åˆ†ææŒ‰éˆ•
    if st.button("ğŸ” é–‹å§‹åˆ†æé¢ç›¸"):
        with st.spinner('ğŸ”® å¤§å¸«æ­£åœ¨æ„Ÿæ‡‰å¤©åº­èˆ‡åœ°é–£... (AI åˆ†æä¸­)'):
            try:
                # ç™¼é€çµ¦ AI çš„æŒ‡ä»¤ (é€™è£¡æˆ‘å€‘æ•…æ„è®“å®ƒåˆ†æ®µè¼¸å‡º)
                prompt = """
                ä½ æ˜¯ä¸€ä½é¢ç›¸å¤§å¸«ã€‚è«‹åˆ†æé€™å¼µç…§ç‰‡ã€‚
                è«‹åš´æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¼¸å‡ºå…©éƒ¨åˆ†ï¼š
                
                ç¬¬ä¸€éƒ¨åˆ†ï¼ˆå…¬é–‹ï¼‰ï¼š
                ã€æ•´é«”æ°£å ´ã€‘ï¼šç”¨ä¸€å¥è©±å½¢å®¹çµ¦äººçš„ç¬¬ä¸€å°è±¡ã€‚
                ã€æ€§æ ¼å„ªå‹¢ã€‘ï¼šç°¡çŸ­åˆ†æä¸€å€‹æ€§æ ¼äº®é»ã€‚
                
                ç¬¬äºŒéƒ¨åˆ†ï¼ˆVIPï¼‰ï¼š
                ã€è²¡å¯Œé‹å‹¢ã€‘ï¼šåˆ†ææœªä¾†çš„è²¡é‹çˆ†ç™¼é»ã€‚
                ã€è²´äººæ–¹ä½ã€‘ï¼šæŒ‡å‡ºèª°æ˜¯è²´äººã€‚
                ã€é¿å‘æŒ‡å—ã€‘ï¼šæœªä¾†ä¸€å€‹æœˆéœ€è¦æ³¨æ„ä»€éº¼ã€‚
                """
                
                response = model.generate_content([prompt, image])
                result = response.text
                
                # --- æ¨¡æ“¬è³ºéŒ¢é‚è¼¯ï¼šå…ˆçµ¦ä½ çœ‹ä¸€é»é» ---
                st.success("åˆ†æå®Œæˆï¼")
                
                # é¡¯ç¤ºå…è²»å…§å®¹
                st.subheader("ğŸ”“ å…è²»åˆ†æå ±å‘Š")
                st.write(result.split("ç¬¬äºŒéƒ¨åˆ†ï¼ˆVIPï¼‰ï¼š")[0]) # åªé¡¯ç¤ºå‰åŠæ®µ
                
                st.divider() # åˆ†éš”ç·š
                
                # æ¨¡ç³Šè™•ç† VIP å…§å®¹ (é€™è£¡æ˜¯ç”¨è¦–è¦ºæ•ˆæœæ¨¡æ“¬)
                st.subheader("ğŸ”’ VIP æ·±åº¦è§£é–")
                st.warning("âš ï¸ æª¢æ¸¬åˆ°æ‚¨çš„è²¡å¸›å®®æœ‰**é‡å¤§ç•°å‹•**ï¼Œä½†è©³ç´°å…§å®¹å·²è¢«é–å®šã€‚")
                st.info("åŒ…å«ï¼šğŸ’° æœªä¾†è²¡é‹çˆ†ç™¼é»ã€ğŸŒŸ å‘½ä¸­è²´äººæ–¹ä½ã€ğŸ›‘ è¿‘æœŸé¿å‘æŒ‡å—")
                
                # æ¨¡æ“¬æ”¯ä»˜æŒ‰éˆ•
                if st.button("ğŸ‘‰ æ”¯ä»˜ $99 è§£é–å®Œæ•´å ±å‘Š (æ¨¡æ“¬)"):
                    st.balloons() # æ”¾ç…™ç«ç‰¹æ•ˆ
                    st.write("ğŸ‰ æ”¯ä»˜æˆåŠŸï¼ä»¥ä¸‹æ˜¯æ‚¨çš„å®Œæ•´å ±å‘Šï¼š")
                    st.write(result) # é€™è£¡æ‰æœƒé¡¯ç¤ºå…¨éƒ¨å…§å®¹

            except Exception as e:
                st.error(f"ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
